#include "stdafx.h"

#include <iostream>
#include <iomanip>
#include <string>
#include <sstream>
#include <string.h>

#include <Windows.h>

#include "debugger.h"

using namespace std;

char* getArg(_TCHAR* arg) {
	int argLength = wcslen(arg);
	int retLength = WideCharToMultiByte(CP_ACP, 0, arg, argLength, NULL, 0, NULL, NULL); // get required length
	char* ret = new char[retLength + 1];
	WideCharToMultiByte(CP_ACP, 0, arg, argLength, ret, retLength, NULL, NULL);

	ret[retLength] = '\0';

	return ret;
}

bool isHex(const char* str) {
	for (int i = 0; str[i] != '\0'; i++)
		if (!(('a' <= str[i] && str[i] <= 'f') || ('0' <= str[i] && str[i] <= '9')))
			return false;
	return true;
}

int _tmain(int argc, _TCHAR* argv[])
{
	if (isDbg()) {
		cerr << "arrête de me débugger stp :(" << endl;
		return -1;
	}

	if (argc < 2) {
		cerr << "nan mais faudrait etre un tantinnet serieux si tu veux que ca marche" << endl;
		return -2;
	}

	char* arg = getArg(argv[1]);
	if (strlen(arg) > 64 || !isHex(arg)) {
		cerr << "faudrait peut-etre savoir ecrire par contre..." << endl;
		// pas en hexa
		return -3;
	}

	char input_str[65] = { 0 };
	memset(input_str, '0', 64);
	strcpy(input_str+(64-strlen(arg)), arg);
	cout << "input: " << input_str << endl;
	char input_key[32] = { 0 };
	for (int i=0; i<32; i++) {
		char segment[sizeof(char)*2+1] = { 0 };
		char* cursor = input_str+(i*sizeof(char)*2);
		memcpy(segment, cursor, sizeof(char)*2);
		char num = strtol(segment, NULL, 16);
		input_key[i] = num;
	}
	cout << "input: ";
	for (int i=0; i<32; i++) cout << hex << setw(2) << setfill('0') << (int) input_key[i];
	cout << endl << "argv[1]: " << arg << endl;
	
	char key[32] = {0};
	if (!memcmp(key, input_key, 32)) {
		cout << "gg" << endl;
	} else {
		cerr << "c'est toujouts pas bon, tri agun" << endl;
	}
	delete[] arg;

	return 0;
}

